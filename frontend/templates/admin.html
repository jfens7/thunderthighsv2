<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gold Coast Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
    
    :root {
        --primary: #facc15;
        --primary-hover: #eab308;
        --bg-dark: #020617;
        --card-bg: #0f172a;
        --border-color: rgba(255, 255, 255, 0.08);
    }
    
    body {
        background-color: var(--bg-dark);
        color: #e2e8f0;
        font-family: 'Inter', sans-serif;
        background-image: radial-gradient(circle at top center, #1e293b 0%, #020617 80%);
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* GLASSMORPHISM UTILS */
    .glass {
        background-color: rgba(15, 23, 42, 0.7);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }

    .glass-panel {
        background: linear-gradient(145deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8));
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* FORM ELEMENTS */
    .input-dark {
        background-color: #020617;
        border: 1px solid #334155;
        color: white;
        padding: 12px 16px;
        border-radius: 12px;
        width: 100%;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    .input-dark:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.15);
    }

    .input-dark::placeholder {
        color: #475569;
    }

    /* DRAG AND DROP SPECIFICS */
    .player-card {
        cursor: grab;
        transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s, border-color 0.2s;
        position: relative;
        z-index: 10;
        user-select: none;
    }
    
    .player-card:hover {
        transform: translateY(-2px) scale(1.01);
        border-color: rgba(250, 204, 21, 0.3);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        z-index: 20;
    }

    .player-card:active {
        cursor: grabbing;
        transform: scale(0.98);
    }

    .dragging {
        opacity: 0.4;
        transform: scale(0.95);
        border: 1px dashed var(--primary);
        filter: grayscale(0.8);
    }

    .drop-active {
        border: 2px dashed var(--primary) !important;
        background: rgba(250, 204, 21, 0.05) !important;
        box-shadow: inset 0 0 20px rgba(250, 204, 21, 0.05);
    }

    .empty-slot {
        border: 1px dashed #334155;
        min-height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        color: #475569;
        font-size: 0.7rem;
        font-weight: 800;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        transition: all 0.2s;
    }

    /* STATUS BADGES */
    .status-badge {
        font-size: 0.65rem;
        padding: 4px 10px;
        border-radius: 6px;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }
    
    .status-draft { background: #334155; color: #94a3b8; border: 1px solid #475569; }
    .status-prelim { background: #1e3a8a; color: #93c5fd; border: 1px solid #3b82f6; }
    .status-official { background: #064e3b; color: #6ee7b7; border: 1px solid #10b981; }

    /* ANIMATIONS */
    @keyframes fadeInScale {
        from { opacity: 0; transform: scale(0.98) translateY(10px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .animate-entry {
        animation: fadeInScale 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    /* SCROLLBAR */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #020617; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="flex flex-col items-center p-4 md:p-8">

    <div id="loginScreen" class="fixed inset-0 flex items-center justify-center bg-slate-950 z-[100]">
        <div class="p-10 bg-slate-900 rounded-3xl border border-slate-800 shadow-2xl text-center w-full max-w-md relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-600 to-yellow-400"></div>
            <div class="w-20 h-20 bg-yellow-500/10 rounded-2xl flex items-center justify-center mx-auto mb-8 border border-yellow-500/20 shadow-lg shadow-yellow-500/10">
                <i class="fa-solid fa-shield-halved text-4xl text-yellow-500"></i>
            </div>
            <h1 class="text-4xl font-black text-white mb-2 tracking-tight">ADMIN PORTAL</h1>
            <p class="text-slate-500 text-sm mb-8 font-medium">Gold Coast Stats v3.2</p>
            <div class="space-y-4">
                <input type="password" id="passwordInput" class="input-dark text-center text-xl tracking-widest" placeholder="••••••••">
                <button id="loginBtn" onclick="login()" class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 rounded-xl font-black text-slate-900 transition-all active:scale-95 shadow-lg shadow-yellow-500/20">
                    AUTHENTICATE ACCESS
                </button>
            </div>
            <div id="loginError" class="mt-6 hidden p-3 bg-red-500/10 border border-red-500/20 rounded-xl">
                <p class="text-red-500 font-bold text-sm flex items-center justify-center gap-2">
                    <i class="fa-solid fa-circle-exclamation"></i> Invalid Credentials
                </p>
            </div>
        </div>
    </div>

    <div id="dashboard" class="w-full max-w-[1600px] hidden opacity-0 transition-opacity duration-700">
        
        <header class="flex flex-col xl:flex-row justify-between items-center mb-10 gap-6">
            <div class="flex items-center gap-5">
                <div class="w-14 h-14 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-2xl flex items-center justify-center text-slate-900 font-bold shadow-xl shadow-yellow-500/20">
                    <i class="fa-solid fa-bolt text-3xl"></i>
                </div>
                <div>
                    <div class="flex items-center gap-3 mb-1">
                        <span class="px-2 py-0.5 bg-green-500/10 border border-green-500/20 text-green-400 text-[10px] font-black rounded uppercase tracking-widest">System Online</span>
                        <span class="px-2 py-0.5 bg-blue-500/10 border border-blue-500/20 text-blue-400 text-[10px] font-black rounded uppercase tracking-widest" id="weatherWidget">24°C Sunny</span>
                    </div>
                    <h1 class="text-3xl font-black text-white tracking-tight uppercase italic">
                        THUNDER <span class="text-yellow-500 underline decoration-4 underline-offset-4 decoration-yellow-500/50">MANAGER</span>
                    </h1>
                </div>
            </div>
            <div class="flex gap-4">
                <button onclick="triggerSync()" id="syncBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg shadow-blue-900/30 transition-all active:scale-95 border-b-4 border-blue-800 hover:border-blue-700">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Sync Firebase
                </button>
                <a href="/" class="bg-slate-800 hover:bg-slate-700 text-slate-200 px-6 py-3 rounded-xl font-bold text-sm border border-white/5 transition-all flex items-center gap-2 hover:text-white">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i> Exit
                </a>
            </div>
        </header>

        <div class="glass rounded-3xl p-8 mb-10 border border-white/10 shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-yellow-500/5 rounded-full blur-3xl -mr-48 -mt-48 pointer-events-none"></div>

            <div class="flex flex-col xl:flex-row justify-between items-start xl:items-end gap-8 mb-8 relative z-10">
                <div class="flex-1">
                    <div class="flex items-center gap-4 mb-3">
                        <h2 class="text-3xl font-black text-white tracking-tight">Auto-Draft Engine</h2>
                        <div id="statusIndicator">
                            <span class="status-badge status-draft"><i class="fa-solid fa-pencil"></i> Mode: Draft</span>
                        </div>
                    </div>
                    <p class="text-slate-400 text-sm mb-6 max-w-3xl leading-relaxed">
                        Generates balanced teams using live rating data. 
                        <b>Smart Parser Enabled:</b> Automatically handles "Shared Spots" (e.g. Name/Name) as single slots and stops parsing at "Team Requests".
                        <b>Jitter Sort:</b> Adds slight randomization to ratings for varied re-rolls.
                    </p>

                    <div class="flex flex-wrap items-center gap-3 bg-black/40 p-2 rounded-2xl border border-white/10 w-fit backdrop-blur-sm shadow-inner">
                        <div class="px-2">
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Division</label>
                            <select id="genDiv" class="bg-transparent text-white font-bold text-sm focus:outline-none cursor-pointer hover:text-yellow-500 transition-colors w-32">
                                <option value="Div 1">Division 1</option>
                                <option value="Div 2">Division 2</option>
                                <option value="Div 3">Division 3</option>
                                <option value="Div 4">Division 4</option>
                                <option value="Div 5">Division 5</option>
                            </select>
                        </div>
                        <div class="h-8 w-px bg-slate-700"></div>
                        <div class="px-2">
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">Format</label>
                            <select id="genSize" class="bg-transparent text-white font-bold text-sm focus:outline-none cursor-pointer hover:text-yellow-500 transition-colors w-40">
                                <option value="3">3 Person Teams</option>
                                <option value="2">2 Person Teams</option>
                            </select>
                        </div>
                        <button onclick="runAutoDraft()" id="genBtn" class="bg-yellow-500 hover:bg-yellow-400 text-slate-900 px-8 py-3 rounded-xl font-black text-sm flex items-center gap-2 transition-all active:scale-95 shadow-lg shadow-yellow-500/20 ml-2">
                            <i class="fa-solid fa-shuffle"></i> GENERATE
                        </button>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-3 w-full xl:w-auto">
                    <button onclick="setApproval('prelim')" id="btnPrelim" class="bg-slate-900/80 hover:bg-blue-900/40 text-blue-400 border border-blue-500/30 px-6 py-4 rounded-xl font-bold text-xs uppercase tracking-wider transition-all shadow-lg flex-1 xl:flex-none flex items-center justify-center gap-2">
                        <i class="fa-regular fa-circle-check text-lg"></i> Approve Prelim
                    </button>
                    <button onclick="setApproval('official')" id="btnOfficial" class="bg-slate-900/80 hover:bg-emerald-900/40 text-emerald-400 border border-emerald-500/30 px-6 py-4 rounded-xl font-bold text-xs uppercase tracking-wider transition-all shadow-lg flex-1 xl:flex-none flex items-center justify-center gap-2">
                        <i class="fa-solid fa-lock text-lg"></i> Approve Official
                    </button>
                </div>
            </div>

            <div id="genLoader" class="hidden py-32 flex flex-col items-center justify-center bg-black/20 rounded-3xl border border-white/5 border-dashed animate-pulse">
                <i class="fa-solid fa-gear fa-spin text-5xl text-yellow-500 mb-6"></i>
                <h3 class="text-2xl font-black text-white tracking-tight">Crunching the Numbers...</h3>
                <p class="text-slate-500 text-sm mt-2">Checking 12-month history & balancing tiers</p>
            </div>

            <div id="genResults" class="hidden space-y-8 animate-entry">
                
                <div id="autoTeamsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div id="requestsBox" class="bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hidden">
                        <h4 class="text-xs font-black text-blue-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-message"></i> Requests Found (Not Drafted)
                        </h4>
                        <ul id="requestsList" class="grid grid-cols-1 gap-2 text-xs font-medium text-slate-400 font-mono"></ul>
                    </div>
                    
                    <div id="reservesBox" class="bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hidden">
                        <h4 class="text-xs font-black text-orange-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-user-clock"></i> Unassigned Pool
                        </h4>
                        <div id="reservesList" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
                
                <div class="flex justify-end pt-6 border-t border-white/5">
                    <button onclick="saveDraftToDB()" class="bg-emerald-600 hover:bg-emerald-500 text-white px-10 py-4 rounded-2xl font-black flex items-center gap-3 transition-all shadow-xl shadow-emerald-900/30 active:scale-95 border-b-4 border-emerald-800 hover:border-emerald-700">
                        <i class="fa-solid fa-floppy-disk text-xl"></i> COMMIT TEAMS TO DATABASE
                    </button>
                </div>
            </div>
        </div>

        <nav class="flex gap-2 mb-8 overflow-x-auto pb-2 border-b border-white/5 no-scrollbar">
            <button onclick="showTab('approvals')" id="tab-approvals" class="px-8 py-4 border-b-2 border-yellow-500 text-yellow-500 font-bold bg-slate-800/50 rounded-t-xl transition-all whitespace-nowrap hover:bg-slate-800">
                <i class="fa-solid fa-check-double mr-2"></i>Live Approvals
            </button>
            <button onclick="showTab('draftpic')" id="tab-draftpic" class="px-8 py-4 border-b-2 border-transparent text-slate-400 hover:text-white font-bold transition-all whitespace-nowrap hover:bg-slate-800/30 rounded-t-xl">
                <i class="fa-solid fa-image mr-2"></i>Draft Summary
            </button>
            <button onclick="showTab('teams')" id="tab-teams" class="px-8 py-4 border-b-2 border-transparent text-slate-400 hover:text-white font-bold transition-all whitespace-nowrap hover:bg-slate-800/30 rounded-t-xl">
                <i class="fa-solid fa-users-gear mr-2"></i>Team Builder
            </button>
            <button onclick="showTab('duplicates')" id="tab-duplicates" class="px-8 py-4 border-b-2 border-transparent text-slate-400 hover:text-white font-bold transition-all whitespace-nowrap hover:bg-slate-800/30 rounded-t-xl">
                <i class="fa-solid fa-clone mr-2"></i>Duplicates
            </button>
            <button onclick="showTab('requests')" id="tab-requests" class="px-8 py-4 border-b-2 border-transparent text-slate-400 hover:text-white font-bold transition-all whitespace-nowrap hover:bg-slate-800/30 rounded-t-xl">
                <i class="fa-solid fa-flag mr-2"></i>Reports
            </button>
            <button onclick="showTab('settings')" id="tab-settings" class="px-8 py-4 border-b-2 border-transparent text-slate-400 hover:text-white font-bold transition-all whitespace-nowrap hover:bg-slate-800/30 rounded-t-xl">
                <i class="fa-solid fa-sliders mr-2"></i>Config
            </button>
            <button onclick="showTab('season')" id="tab-season" class="px-8 py-4 border-b-2 border-transparent text-slate-400 hover:text-white font-bold transition-all whitespace-nowrap hover:bg-slate-800/30 rounded-t-xl">
                <i class="fa-solid fa-calendar-days mr-2"></i>Season
            </button>
        </nav>

        <div id="panel-draftpic" class="glass rounded-3xl p-8 shadow-xl hidden min-h-[400px] animate-entry">
            <div class="flex justify-between items-center mb-8 border-b border-white/5 pb-6">
                <div>
                    <h2 class="text-2xl font-black flex items-center gap-3 text-white">
                        <i class="fa-solid fa-list-ol text-blue-500"></i> Draft Summary Table
                    </h2>
                    <p class="text-slate-500 text-sm mt-1">Consolidated view of all approved divisions. Copy this for Discord/Facebook announcements.</p>
                </div>
                <button onclick="copyDraft()" class="bg-slate-800 hover:bg-slate-700 text-white px-5 py-2.5 rounded-xl font-bold text-sm border border-white/10 transition-all flex items-center gap-2 shadow-lg">
                    <i class="fa-regular fa-copy"></i> Copy to Clipboard
                </button>
            </div>
            <div id="draftPicContent" class="space-y-12 text-white font-mono text-sm bg-black/40 p-10 rounded-2xl border border-white/5 shadow-inner">
                <div class="text-slate-500 italic text-center py-10">No preliminary teams have been approved yet. Use the Generator above.</div>
            </div>
        </div>

        <div id="panel-approvals" class="glass rounded-3xl p-8 shadow-xl min-h-[400px] animate-entry">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-3 text-white border-b border-white/5 pb-4">
                <i class="fa-solid fa-check-double text-green-500"></i> Unverified Live Matches
            </h2>
            <div id="approvalsList" class="space-y-4"></div>
        </div>

        <div id="panel-teams" class="glass rounded-3xl p-8 shadow-xl hidden min-h-[400px] animate-entry">
            <div class="flex flex-wrap items-center gap-4 mb-8 border-b border-white/5 pb-6">
                <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                    <i class="fa-solid fa-users-gear text-slate-400"></i> Manage Teams
                </h2>
                <div class="h-8 w-px bg-slate-700 mx-2"></div>
                <select id="teamSeason" class="input-dark w-48 font-bold text-sm" onchange="loadTeams()"></select>
                <select id="teamDiv" class="input-dark w-48 font-bold text-sm" onchange="renderTeamsUI()">
                    <option value="Division 1">Division 1</option>
                    <option value="Division 2">Division 2</option>
                    <option value="Division 3">Division 3</option>
                    <option value="Division 4">Division 4</option>
                    <option value="Division 5">Division 5</option>
                </select>
                <button onclick="openAddTeamModal()" class="ml-auto bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg transition-all active:scale-95 flex items-center gap-2">
                    <i class="fa-solid fa-plus"></i> New Team
                </button>
            </div>
            <div id="teamsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
        </div>

        <div id="panel-duplicates" class="glass rounded-3xl p-8 shadow-xl hidden min-h-[400px] animate-entry">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-3 text-white">
                <i class="fa-solid fa-users-viewfinder text-orange-500"></i> Player Reconciliation
            </h2>
            <p class="text-slate-400 text-sm mb-8">Identify and merge duplicate player profiles to maintain rating integrity.</p>
            <button onclick="findDuplicates()" class="bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-xl mb-8 text-sm font-bold transition-all shadow-lg border border-white/5">
                Scan Database for Duplicates
            </button>
            <div id="dupeList" class="space-y-4 grid grid-cols-1 lg:grid-cols-2 gap-6"></div>
        </div>

        <div id="panel-requests" class="glass rounded-3xl p-8 hidden min-h-[400px] animate-entry">
             <div class="flex justify-between items-center mb-8">
                 <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                     <i class="fa-solid fa-flag text-red-500"></i> User Reports
                 </h2>
                 <button onclick="loadRequests()" class="text-yellow-500 hover:text-white font-bold text-sm transition-colors flex items-center gap-2">
                     <i class="fa-solid fa-rotate"></i> Refresh List
                 </button>
             </div>
             <div class="overflow-x-auto rounded-2xl border border-white/5 bg-slate-900/30">
                 <table class="w-full text-left text-sm text-slate-400">
                     <thead class="bg-slate-900/80 text-xs uppercase font-bold text-slate-500">
                         <tr>
                             <th class="p-5">Reporter</th>
                             <th class="p-5">Category</th>
                             <th class="p-5">Description</th>
                             <th class="p-5 text-right">Action</th>
                         </tr>
                     </thead>
                     <tbody id="requestsTable" class="divide-y divide-white/5"></tbody>
                 </table>
             </div>
        </div>

        <div id="panel-settings" class="glass rounded-3xl p-8 hidden min-h-[400px] animate-entry">
            <h2 class="text-2xl font-bold mb-8 text-white flex items-center gap-3">
                <i class="fa-solid fa-sliders text-slate-400"></i> Global Configuration
            </h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-slate-900/50 p-8 rounded-3xl border border-slate-800">
                    <h3 class="font-bold mb-6 text-yellow-500 uppercase tracking-widest text-xs flex items-center gap-2">
                        <i class="fa-solid fa-paint-roller"></i> Appearance & Themes
                    </h3>
                    <label class="block text-slate-400 text-sm font-bold mb-2">Active Holiday Theme</label>
                    <select id="setHoliday" class="input-dark mb-6">
                        <option value="auto">Auto (Date Detect)</option>
                        <option value="christmas">Christmas</option>
                        <option value="halloween">Halloween</option>
                        <option value="easter">Easter</option>
                        <option value="normal">Standard (No Decoration)</option>
                    </select>
                    
                    <div class="flex items-center justify-between mt-4">
                        <span class="text-slate-300 font-bold text-sm">Enable Weather Widget</span>
                        <input type="checkbox" checked class="w-5 h-5 accent-yellow-500 rounded cursor-pointer">
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-white/5 flex justify-end">
                <button onclick="saveSettings()" class="bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-bold px-8 py-3 rounded-xl shadow-lg active:scale-95 transition-all">
                    Save Configuration
                </button>
            </div>
        </div>

        <div id="panel-season" class="glass rounded-3xl p-8 hidden min-h-[400px] animate-entry">
            <div class="grid md:grid-cols-2 gap-12">
                <div class="text-center py-12 border-r border-slate-700/50 pr-12">
                    <div class="w-16 h-16 bg-green-500/10 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fa-solid fa-calendar-plus text-3xl text-green-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">Create New Season</h2>
                    <p class="text-slate-500 text-sm mb-6">Initialize database for a new competition.</p>
                    <input type="text" id="newSeasonName" class="input-dark p-4 text-center mb-6 text-lg font-bold placeholder-slate-600" placeholder="e.g. Summer 2026">
                    <button onclick="createNewSeason()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95">
                        Launch Season
                    </button>
                </div>
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-red-500/10 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fa-solid fa-trash-can text-3xl text-red-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">Archive / Delete</h2>
                    <p class="text-slate-500 text-sm mb-6">Permanently remove season data.</p>
                    <select id="deleteSeasonSelect" class="input-dark p-4 text-center mb-6 text-lg font-bold"></select>
                    <button onclick="deleteSeason()" class="w-full bg-red-900/20 hover:bg-red-900/30 text-red-500 border border-red-900/50 font-bold py-4 rounded-xl transition-all active:scale-95">
                        Delete Selected Season
                    </button>
                </div>
            </div>
        </div>

    </div>

    <div id="teamModal" class="fixed inset-0 flex items-center justify-center hidden z-50 backdrop-blur-xl bg-black/70">
        <div class="bg-slate-900 rounded-3xl p-8 w-full max-w-lg border border-slate-700 shadow-2xl relative animate-entry">
            <button onclick="closeTeamModal()" class="absolute top-6 right-6 text-slate-500 hover:text-white transition-colors bg-slate-800 w-8 h-8 rounded-full flex items-center justify-center">
                <i class="fa-solid fa-xmark text-lg"></i>
            </button>
            <h3 class="text-2xl font-black text-white mb-8 flex items-center gap-3">
                <i class="fa-solid fa-pen-to-square text-yellow-500"></i> Edit Team
            </h3>
            <div class="space-y-6">
                <div>
                    <label class="text-slate-500 text-xs font-bold uppercase mb-2 block tracking-widest">Team Name</label>
                    <input id="modalTeamName" type="text" class="input-dark text-lg" placeholder="e.g. Thunder 1">
                </div>
                <div>
                    <label class="text-slate-500 text-xs font-bold uppercase mb-2 block flex justify-between">
                        <span>Level 1 Player</span> <span class="text-green-500 text-[10px] bg-green-500/10 px-2 py-0.5 rounded">STAR</span>
                    </label>
                    <input id="modalL1" list="playerList" class="input-dark" placeholder="Search Player...">
                </div>
                <div>
                    <label class="text-slate-500 text-xs font-bold uppercase mb-2 block flex justify-between">
                        <span>Level 2 Player</span> <span class="text-yellow-500 text-[10px] bg-yellow-500/10 px-2 py-0.5 rounded">MID</span>
                    </label>
                    <input id="modalL2" list="playerList" class="input-dark" placeholder="Search Player...">
                </div>
                <div>
                    <label class="text-slate-500 text-xs font-bold uppercase mb-2 block flex justify-between">
                        <span>Level 3 Player</span> <span class="text-red-500 text-[10px] bg-red-500/10 px-2 py-0.5 rounded">BASE</span>
                    </label>
                    <input id="modalL3" list="playerList" class="input-dark" placeholder="Search Player...">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4 mt-10">
                <button onclick="deleteTeam()" class="py-4 bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/50 rounded-xl font-bold transition-all">
                    Delete Team
                </button>
                <button onclick="saveTeam()" class="py-4 bg-yellow-500 hover:bg-yellow-400 text-slate-900 rounded-xl font-bold shadow-lg transition-all active:scale-95">
                    Save Changes
                </button>
            </div>
            <datalist id="playerList"></datalist>
        </div>
    </div>

    <script>
    // --- GLOBAL VARIABLES ---
    let currentDraft = { teams: [], reserves: [], requests: [] };
    let draftSummary = {}; // Stores { "Div 1": [teams...], "Div 2": [teams...] }
    let approvalStatus = 'draft'; // 'draft', 'prelim', 'official'
    let draggedData = null;
    let allTeams = []; // For Legacy Team Builder

    // --- AUTHENTICATION ---
    async function login() {
        const pwd = document.getElementById('passwordInput').value;
        const btn = document.getElementById('loginBtn');
        const err = document.getElementById('loginError');
        
        btn.disabled = true;
        btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> AUTHENTICATING...';

        try {
            const res = await fetch('/api/admin/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({password: pwd})
            });
            
            if(res.ok) { 
                document.getElementById('loginScreen').classList.add('hidden'); 
                const db = document.getElementById('dashboard');
                db.classList.remove('hidden'); 
                setTimeout(() => db.classList.add('opacity-100'), 50);
                initData(); 
            } else { 
                err.classList.remove('hidden'); 
                pwd.value = '';
            }
        } catch(e) {
            console.error(e);
            alert("Login Connection Failed: Check Server");
        } finally {
            btn.disabled = false;
            btn.innerHTML = 'UNLOCK SYSTEM';
        }
    }

    async function initData() {
        // Init functions for all tabs
        loadApprovals();
        loadSettings();
        
        // Fetch Seasons
        try {
            const sRes = await fetch('/api/seasons');
            const seasons = await sRes.json();
            const sSelect = document.getElementById('teamSeason');
            const dSelect = document.getElementById('deleteSeasonSelect');
            seasons.forEach(s => { 
                sSelect.add(new Option(s, s));
                dSelect.add(new Option(s, s));
            });
            if(seasons.length > 0) sSelect.value = seasons[seasons.length-1];

            // Fetch All Players for Datalist
            const pRes = await fetch('/api/players');
            const allPlayers = await pRes.json();
            const dl = document.getElementById('playerList');
            allPlayers.forEach(p => { 
                const opt = document.createElement('option'); 
                opt.value = p; 
                dl.appendChild(opt); 
            });
            
            loadTeams();
            loadRequests();
        } catch(e) {
            console.error("Init Data Failed", e);
        }
    }

    // --- TAB SYSTEM ---
    function showTab(tab) {
        // Hide all panels
        ['approvals', 'draftpic', 'duplicates', 'teams', 'requests', 'settings', 'season'].forEach(t => {
            document.getElementById(`panel-${t}`).classList.add('hidden');
            const btn = document.getElementById(`tab-${t}`);
            btn.classList.remove('border-yellow-500', 'text-yellow-500', 'bg-slate-800');
            btn.classList.add('border-transparent', 'text-slate-400');
        });
        
        // Show selected panel
        document.getElementById(`panel-${tab}`).classList.remove('hidden');
        const active = document.getElementById(`tab-${tab}`);
        active.classList.add('border-yellow-500', 'text-yellow-500', 'bg-slate-800');
        active.classList.remove('border-transparent', 'text-slate-400');
    }

    // --- SMART DRAFT GENERATOR LOGIC ---
    async function runAutoDraft() {
        if(approvalStatus === 'official') {
            if(!confirm("WARNING: Teams are currently locked as OFFICIAL.\n\nRegenerating will discard the current official lineups. Are you sure?")) return;
        }
        
        const div = document.getElementById('genDiv').value;
        const size = document.getElementById('genSize').value;
        const btn = document.getElementById('genBtn');
        const loader = document.getElementById('genLoader');
        const resDiv = document.getElementById('genResults');

        btn.disabled = true;
        loader.classList.remove('hidden');
        resDiv.classList.add('hidden');

        try {
            const res = await fetch('/api/admin/generate-teams', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ division: div, team_size: parseInt(size) })
            });
            
            const data = await res.json();
            
            if (data.error) throw new Error(data.error);
            
            currentDraft = data;
            
            // Reset approval state for new draft
            setApproval('draft', false);
            
            renderDraft();
        } catch(e) {
            alert("Error generating teams: " + e.message);
        } finally {
            btn.disabled = false;
            loader.classList.add('hidden');
            resDiv.classList.remove('hidden');
        }
    }

    function renderDraft() {
        const grid = document.getElementById('autoTeamsGrid');
        grid.innerHTML = '';

        currentDraft.teams.forEach((team, idx) => {
            const card = document.createElement('div');
            card.className = "bg-slate-900 border border-white/5 rounded-2xl overflow-hidden shadow-lg hover:border-white/10 transition-colors";
            
            // Determine if we show P3
            let p3HTML = '';
            if(team.p3 || document.getElementById('genSize').value == "3") {
                p3HTML = renderPlayerRow(team.p3, 3, idx);
            }

            card.innerHTML = `
                <div class="bg-black/40 p-4 border-b border-white/5 flex justify-between items-center">
                    <span class="font-black text-white text-xs tracking-wider uppercase">Team ${team.id}</span>
                    <span class="text-xs font-mono font-bold text-yellow-500 bg-yellow-500/10 px-2 py-0.5 rounded">Avg: ${team.avg}</span>
                </div>
                <div class="p-3 space-y-2">
                    ${renderPlayerRow(team.p1, 1, idx)}
                    ${renderPlayerRow(team.p2, 2, idx)}
                    ${p3HTML}
                </div>
            `;
            grid.appendChild(card);
        });

        // Reserves
        const rBox = document.getElementById('reservesBox');
        if(currentDraft.reserves && currentDraft.reserves.length > 0) {
            rBox.classList.remove('hidden');
            document.getElementById('reservesList').innerHTML = currentDraft.reserves.map(r => 
                `<span class="px-3 py-1 bg-slate-800 rounded-lg border border-white/10 text-xs font-bold text-slate-400">${r}</span>`
            ).join('');
        } else {
            rBox.classList.add('hidden');
        }

        // Requests
        const reqBox = document.getElementById('requestsBox');
        if(currentDraft.requests && currentDraft.requests.length > 0) {
            reqBox.classList.remove('hidden');
            document.getElementById('requestsList').innerHTML = currentDraft.requests.map(r => 
                `<li><i class="fa-solid fa-angle-right text-blue-500 mr-2"></i>${r}</li>`
            ).join('');
        } else {
            reqBox.classList.add('hidden');
        }

        setupDragAndDrop();
    }

    function renderPlayerRow(p, slot, teamIdx) {
        if(!p) {
            return `
                <div class="empty-slot" 
                     data-team-idx="${teamIdx}" 
                     data-slot="p${slot}">
                    EMPTY SLOT
                </div>`;
        }
        
        const colors = {1: 'text-green-400', 2: 'text-yellow-400', 3: 'text-red-400'};
        const colorClass = colors[slot];
        
        return `
            <div class="player-card bg-slate-800/50 p-2.5 rounded-xl border border-white/5 flex justify-between items-center group"
                 draggable="${approvalStatus !== 'official'}"
                 data-team-idx="${teamIdx}"
                 data-slot="p${slot}">
                <div class="flex items-center gap-3">
                    <span class="text-[9px] font-black bg-slate-950 px-1.5 py-0.5 rounded text-slate-500">#${slot}</span>
                    <span class="text-xs font-bold text-white group-hover:${colorClass} transition-colors truncate max-w-[140px]">${p.name}</span>
                </div>
                <span class="text-[10px] font-mono text-slate-500">${p.display_rating}</span>
            </div>
        `;
    }

    // --- DRAG & DROP LOGIC ---
    function setupDragAndDrop() {
        if(approvalStatus === 'official') return; // Disable dragging in Official mode
        
        const nodes = document.querySelectorAll('.player-card, .empty-slot');
        
        nodes.forEach(node => {
            node.ondragstart = (e) => {
                if(node.classList.contains('empty-slot')) {
                    e.preventDefault();
                    return;
                }
                draggedData = { 
                    tIdx: node.dataset.teamIdx, 
                    slot: node.dataset.slot 
                };
                node.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            };

            node.ondragend = () => {
                node.classList.remove('dragging');
                document.querySelectorAll('.drop-active').forEach(el => el.classList.remove('drop-active'));
            };

            node.ondragover = (e) => {
                e.preventDefault();
                node.classList.add('drop-active');
            };

            node.ondragleave = () => {
                node.classList.remove('drop-active');
            };

            node.ondrop = (e) => {
                e.preventDefault();
                node.classList.remove('drop-active');
                
                if(draggedData) {
                    const targetData = { 
                        tIdx: node.dataset.teamIdx, 
                        slot: node.dataset.slot 
                    };
                    executeSwap(draggedData, targetData);
                }
            };
        });
    }

    function executeSwap(src, tgt) {
        const sTeam = currentDraft.teams[src.tIdx];
        const tTeam = currentDraft.teams[tgt.tIdx];
        
        // Swap Players
        const temp = sTeam[src.slot];
        sTeam[src.slot] = tTeam[tgt.slot];
        tTeam[tgt.slot] = temp;

        // Recalculate Averages
        [sTeam, tTeam].forEach(t => {
            let sum = 0, count = 0;
            ['p1','p2','p3'].forEach(k => { 
                if(t[k]) { 
                    sum += t[k].numeric_rating; 
                    count++; 
                } 
            });
            t.avg = count > 0 ? Math.round(sum/count) : 0;
        });

        renderDraft();
    }

    // --- APPROVAL WORKFLOW ---
    function setApproval(status, alertUser=true) {
        approvalStatus = status;
        const ind = document.getElementById('statusIndicator');
        const btnOff = document.getElementById('btnOfficial');
        const btnPre = document.getElementById('btnPrelim');

        // Reset Styles
        [btnOff, btnPre].forEach(b => b.classList.remove('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-slate-900'));

        if(status === 'official') {
            ind.innerHTML = `<span class="status-badge status-official">OFFICIAL (LOCKED)</span>`;
            btnOff.classList.add('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-slate-900');
            if(alertUser) alert("Teams Locked as Official. Drag & Drop is now disabled.");
        } 
        else if(status === 'prelim') { 
            ind.innerHTML = `<span class="status-badge status-prelim">PRELIMINARY</span>`;
            btnPre.classList.add('ring-2', 'ring-white', 'ring-offset-2', 'ring-offset-slate-900');
            
            // Populate Draft Pic
            updateDraftSummary();
            
            if(alertUser) {
                alert("Draft added to Summary Tab.");
                showTab('draftpic');
            }
        } 
        else {
            ind.innerHTML = `<span class="status-badge status-draft">DRAFT MODE</span>`;
        }
        
        renderDraft(); // Re-render to update drag listeners
    }

    // --- DRAFT PIC (SUMMARY) LOGIC ---
    function updateDraftSummary() {
        const divName = document.getElementById('genDiv').value;
        // Deep copy current draft to summary object
        draftSummary[divName] = JSON.parse(JSON.stringify(currentDraft.teams));
        renderDraftSummary();
    }

    function renderDraftSummary() {
        const container = document.getElementById('draftPicContent');
        container.innerHTML = '';
        
        if(Object.keys(draftSummary).length === 0) { 
            container.innerHTML = '<div class="text-slate-500 italic text-center py-10">No preliminary teams generated yet.</div>'; 
            return; 
        }
        
        // Loop through all saved divisions
        Object.keys(draftSummary).forEach(divName => {
            const teams = draftSummary[divName];
            
            let html = `
                <div class="mb-10 border-b border-white/10 pb-8">
                    <h3 class="text-2xl font-black text-yellow-500 mb-6 uppercase tracking-widest border-l-4 border-yellow-500 pl-4 flex items-center gap-3">
                        ${divName} <span class="text-xs bg-slate-800 text-slate-400 px-2 py-1 rounded normal-case font-medium border border-white/10">${teams.length} Teams</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            `;
            
            teams.forEach(t => {
                let p1 = t.p1 ? t.p1.name : "VACANT";
                let p2 = t.p2 ? t.p2.name : "VACANT";
                let p3 = t.p3 ? t.p3.name : "";
                
                // Format for clean copying
                html += `
                    <div class="bg-black/20 p-4 rounded-lg border border-white/5 flex items-center gap-3 group hover:border-white/10 transition-colors">
                        <span class="font-black text-slate-500 w-16 bg-slate-900/50 py-1 text-center rounded">T${t.id}</span>
                        <div class="flex-1 font-bold text-sm">
                            <span class="text-green-400">${p1}</span> 
                            <span class="text-slate-600 mx-1">/</span> 
                            <span class="text-yellow-400">${p2}</span>
                            ${p3 ? `<span class="text-slate-600 mx-1">/</span> <span class="text-red-400">${p3}</span>` : ''}
                        </div>
                    </div>
                `;
            });
            
            html += `</div></div>`;
            container.innerHTML += html;
        });
    }

    function copyDraft() {
        const text = document.getElementById('draftPicContent').innerText;
        navigator.clipboard.writeText(text).then(() => alert("Summary copied to clipboard!"));
    }

    async function saveDraftToDB() {
        if(!confirm("Commit these teams to the database? This will update the live site.")) return;
        // In production, you would POST to /api/admin/save-teams
        // await fetch(...)
        alert("Teams Saved Successfully!");
    }

    // --- LEGACY TAB FUNCTIONS (Preserved from Original) ---

    async function loadApprovals() {
        const div = document.getElementById('approvalsList');
        div.innerHTML = '<div class="text-center text-slate-500 italic py-10">Scanning...</div>';
        try {
            const res = await fetch('/api/admin/unverified');
            const matches = await res.json();
            if (matches.length === 0) {
                div.innerHTML = '<div class="text-center text-slate-500 italic py-10 border-2 border-dashed border-slate-800 rounded-2xl">No unverified matches found.</div>';
                return;
            }
            div.innerHTML = '';
            matches.forEach(m => {
                div.innerHTML += `
                    <div class="bg-slate-800 p-6 rounded-2xl border border-white/5 flex justify-between items-center">
                        <div>
                            <div class="text-xs text-yellow-500 font-bold uppercase mb-1">${m.season} | ${m.division} | Week ${m.week}</div>
                            <div class="text-white font-bold text-lg">${m.player1} vs ${m.player2}</div>
                            <div class="text-sm text-slate-300">Live Score: <span class="text-green-400 font-mono font-bold">${m.score_string}</span></div>
                        </div>
                        <button onclick="approveMatch('${m.match_id}')" class="bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-lg font-bold shadow-lg">Approve</button>
                    </div>`;
            });
        } catch (e) {
            div.innerHTML = '<div class="text-red-500 text-center">Connection Error</div>';
        }
    }

    async function approveMatch(mid) {
        if (!confirm("Confirm final result?")) return;
        await fetch('/api/admin/verify_match', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({match_id: mid}) });
        loadApprovals();
    }

    async function loadTeams() {
        const season = document.getElementById('teamSeason').value;
        if (!season) return;
        const res = await fetch(`/api/admin/teams/${encodeURIComponent(season)}`);
        allTeams = await res.json();
        renderTeamsUI();
    }

    function renderTeamsUI() {
        const currentDiv = document.getElementById('teamDiv').value;
        const container = document.getElementById('teamsGrid');
        container.innerHTML = '';
        const divTeams = allTeams.filter(t => t.Division === currentDiv);
        
        if (divTeams.length === 0) {
            container.innerHTML = `<div class="col-span-3 text-center text-slate-500 py-10 border border-slate-800 border-dashed rounded-xl">No teams found.</div>`;
            return;
        }

        divTeams.forEach(team => {
            container.innerHTML += `
                <div class="bg-slate-800/50 border border-slate-700/50 p-6 rounded-xl relative hover:border-slate-600 transition-colors group">
                    <h3 class="text-lg font-black text-white mb-4 pb-2 border-b border-slate-700/50 flex items-center gap-2">
                        <i class="fa-solid fa-people-group text-slate-600"></i> ${team['Team Name']}
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm"><span class="text-slate-400 font-bold">L1</span> <span class="text-white">${team['L1_Player'] || '-'}</span></div>
                        <div class="flex justify-between text-sm"><span class="text-slate-400 font-bold">L2</span> <span class="text-white">${team['L2_Player'] || '-'}</span></div>
                        <div class="flex justify-between text-sm"><span class="text-slate-400 font-bold">L3</span> <span class="text-white">${team['L3_Player'] || '-'}</span></div>
                    </div>
                    <button onclick='openEditTeam("${team['Team Name']}")' class="absolute top-5 right-5 text-slate-600 hover:text-yellow-500">
                        <i class="fa-solid fa-pen-to-square"></i>
                    </button>
                </div>`;
        });
    }

    function openAddTeamModal() {
        document.getElementById('modalTeamName').value = '';
        document.getElementById('modalTeamName').readOnly = false;
        ['modalL1','modalL2','modalL3'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('teamModal').classList.remove('hidden');
    }

    function openEditTeam(teamName) {
        const team = allTeams.find(t => t['Team Name'] === teamName && t.Division === document.getElementById('teamDiv').value);
        if(!team) return;
        document.getElementById('modalTeamName').value = team['Team Name'];
        document.getElementById('modalTeamName').readOnly = true;
        document.getElementById('modalL1').value = team['L1_Player'];
        document.getElementById('modalL2').value = team['L2_Player'];
        document.getElementById('modalL3').value = team['L3_Player'];
        document.getElementById('teamModal').classList.remove('hidden');
    }
    
    function closeTeamModal() { document.getElementById('teamModal').classList.add('hidden'); }

    async function saveTeam() {
        const payload = {
            season: document.getElementById('teamSeason').value,
            division: document.getElementById('teamDiv').value,
            team_name: document.getElementById('modalTeamName').value,
            l1: document.getElementById('modalL1').value,
            l2: document.getElementById('modalL2').value,
            l3: document.getElementById('modalL3').value
        };
        await fetch('/api/admin/save_team', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
        closeTeamModal();
        loadTeams();
    }

    async function deleteTeam() {
        if(!confirm("Delete team?")) return;
        const payload = { season: document.getElementById('teamSeason').value, division: document.getElementById('teamDiv').value, team_name: document.getElementById('modalTeamName').value };
        await fetch('/api/admin/delete_team', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
        closeTeamModal();
        loadTeams();
    }

    async function findDuplicates() {
        const list = document.getElementById('dupeList');
        list.innerHTML = '<div class="text-slate-500 italic text-center py-4">Scanning...</div>';
        const res = await fetch('/api/admin/find_duplicates');
        const dupes = await res.json();
        list.innerHTML = '';
        if(dupes.length === 0) { list.innerHTML = '<div class="text-green-500 font-bold text-center py-4">No duplicates found.</div>'; return; }
        dupes.forEach(d => {
            list.innerHTML += `
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 flex justify-between items-center">
                    <div>
                        <div class="text-yellow-500 font-bold text-sm">Potential Duplicate</div>
                        <div class="text-white text-sm mt-1">A: ${d.name1}</div>
                        <div class="text-white text-sm mt-1">B: ${d.name2}</div>
                    </div>
                    <button class="bg-blue-600 text-white px-3 py-1 rounded text-xs font-bold">Merge</button>
                </div>`;
        });
    }

    async function loadRequests() {
        const tbody = document.getElementById('requestsTable');
        tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center italic text-slate-500">Loading...</td></tr>';
        const res = await fetch('/api/admin/requests');
        const data = await res.json();
        tbody.innerHTML = '';
        if(data.length === 0) { tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center italic text-slate-500">No reports.</td></tr>'; return; }
        data.forEach(r => {
            tbody.innerHTML += `
                <tr class="hover:bg-white/5 transition-colors">
                    <td class="p-4 font-bold text-white">${r['Reporter Name']}</td>
                    <td class="p-4 text-yellow-500 text-xs font-bold uppercase">${r['Match/Issue']}</td>
                    <td class="p-4 text-slate-300 italic">"${r.Description}"</td>
                    <td class="p-4 text-right"><button class="text-green-400 border border-green-500/30 px-2 py-1 rounded text-xs hover:bg-green-500/10">Fixed</button></td>
                </tr>`;
        });
    }

    async function createNewSeason() {
        const name = document.getElementById('newSeasonName').value;
        if(!name) return;
        await fetch('/api/admin/create_season', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({name}) });
        location.reload();
    }

    async function deleteSeason() {
        const name = document.getElementById('deleteSeasonSelect').value;
        if(!confirm(`Delete ${name}?`)) return;
        await fetch('/api/admin/delete_season', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({name}) });
        location.reload();
    }
    
    async function loadSettings() {
        const res = await fetch('/api/admin/settings');
        const s = await res.json();
        document.getElementById('setHoliday').value = s.holiday_mode || 'auto';
    }
    
    async function saveSettings() {
        await fetch('/api/admin/settings', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ holiday_mode: document.getElementById('setHoliday').value }) });
        alert("Settings Saved!");
    }
    </script>
</body>
</html>